#### HashMap 详细解析源码

​      在学习红黑树之前需要先理解下二叉查找树.什么是二叉查找树?

#### 二叉查找树 (Binary Search Tree)

二叉查找树的特性:

> 1. 左树上的所有结点的值均小于或等于它的根结点的值.
> 2. 右树上的所有结点的值均大于或等于它的根结点的值.
> 3. 左 .右树也分别为二叉排序树.

典型的二叉查找树:

![](https://ws1.sinaimg.cn/large/6b297ce5gy1fx59bycxa5j20i90a940v.jpg)

那么二叉查找树这样的数据结构有什么好处?

​       查找一下值为10的节点

![](https://ws1.sinaimg.cn/large/6b297ce5gy1fx5e972sacj20iw0amgn5.jpg)

​        这种方式就是二分查找的思想,查找所需的最大次数等同于二叉查找树的高度.在插入节点的时候也是利用类似的方法,然后逐层比较大小找到新节点适合插入的位置.但二叉查找树存在一个严重的问题.

二叉查找树的缺陷?

​       假设一个二叉查找树只有三个节点,根节点值为9，左孩子值为8，右孩子值为12,接下来依次插入五个节点:7,6,5,4,3.按照二叉查找树的特性,那么会发生什么情况?

![](https://ws1.sinaimg.cn/large/6b297ce5gy1fx5ekh956aj20f90hl3zw.jpg)

​          虽然这个情况下也符合二叉查找树的特性,但查找的性能就大打折扣了,几乎变成了线性.那么怎么解决这种情况呢?因此红黑树就诞生了.

#### 红黑树(Red Black Tree)

​         红黑树拥有二叉查找树的特性,它是一种自平衡的二叉查找树.既然能自平衡,那么从哪些方面来体现它的自平衡呢?来看看红黑树的特性:

![](https://ws1.sinaimg.cn/large/6b297ce5gy1fx6f51yu7gj20i70ajtbw.jpg)

> 1. 节点是红色或黑色.
> 2. 根节点是黑色的.
> 3. 如果节点为红色,它的两个子节点必须为黑色.
> 4. 每个叶子节点都是黑色的空节点(NIL节点)
> 5. 从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点.

​        关于第5点特性,我从字面上其实理解不了.所以详细地讲一讲:

​              ![](https://ws1.sinaimg.cn/large/6b297ce5gy1fx6j3cwfduj20i40aln12.jpg)

​        可以看到每条颜色不同的线连起来的黑色节点都是3个.这就是从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点.           

 正是因为以上的规则限制,才保证了红黑树的自平衡.红黑树从根到叶子的最长路径不会超过最短路径的2倍.(保证了树的高度)

##### 红黑树的操作

​       当插入或删除节点的时候,红黑树的规则有可能被打破.这时候就需要做出一些调整,来继续维持红黑树的规则.



参考资料:

关于String中的hashCode()方法为什么使用31来做乘子 https://segmentfault.com/a/1190000010799123

HashMap源码详细分析 http://www.tianxiaobo.com/2018/01/18/HashMap-%E6%BA%90%E7%A0%81%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90-JDK1-8/

漫画:什么是红黑树?  https://juejin.im/post/5a27c6946fb9a04509096248

